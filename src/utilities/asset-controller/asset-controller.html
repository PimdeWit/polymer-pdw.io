<link rel="import" href="../../../bower_components/polymer/polymer-element.html">

<dom-module id="asset-controller">
  <script>
    class AssetController extends Polymer.Element {
      static get is() { return 'asset-controller'; }
      static get properties() {
        return {
          rootPath: String,

          assets: {
            type: Object,
            notify: true,
            value: {}
          },

          timestamp: {
            type: Number,
            value: () => {
              return Date.now();
            }
          }
        };
      }

      constructor() {
        super();
      }

      connectedCallback() {
        super.connectedCallback();


        const imageMeta = {
          id: 'screenshot',
          url: '../../images/test/rano_compressed.jpg',
          alt: 'Hello mum!'
        }

        this.addImageToGlobal(imageMeta);
      }

      async addImageToGlobal(imageMeta) {
        const response = await this.getImage(imageMeta.url, imageMeta.alt);
        this.assets[imageMeta.id] = response.target;
      }

      getImage(url, alt) {
        return new Promise((resolve, reject) => {
          let image = new Image()
          if (url.includes('http')) image.crossOrigin = 'Anonymous';
          if (!alt) image.setAttribute('role', 'presentation');
          image.onload = (texture) => resolve(texture);
          image.onerror = (texture) => reject(url);
          image.alt = alt || '';
          image.src = url + `?v=${this.timestamp}`;
        });
      }
    }

    window.customElements.define(AssetController.is, AssetController);
  </script>
</dom-module>
